#############################################
# FastAPI RBAC Production Environment Configuration
# 
# IMPORTANT: This file contains production-specific settings.
# Copy to .env.production and update all values marked with TODO.
#############################################

#############################################
# Application Configuration
#############################################
MODE=production
PROJECT_NAME=fastapi-rbac
DEBUG=false
LOG_LEVEL=INFO
USERS_OPEN_REGISTRATION=false

# Frontend URL - TODO: Update with your production domain
FRONTEND_URL=https://your-production-domain.com
PASSWORD_RESET_URL=https://your-production-domain.com/reset-password

# CORS Origins - TODO: Update with your production domain(s)
BACKEND_CORS_ORIGINS=["https://your-production-domain.com"]

#############################################
# Security Keys - TODO: MUST GENERATE NEW KEYS
# Generate new keys using:
# python -c "import secrets; print(secrets.token_urlsafe(32))"
#############################################
SECRET_KEY=TODO_GENERATE_NEW_SECRET_KEY
JWT_SECRET_KEY=TODO_GENERATE_NEW_JWT_SECRET_KEY
JWT_REFRESH_SECRET_KEY=TODO_GENERATE_NEW_JWT_REFRESH_SECRET_KEY
JWT_RESET_SECRET_KEY=TODO_GENERATE_NEW_JWT_RESET_SECRET_KEY
JWT_VERIFICATION_SECRET_KEY=TODO_GENERATE_NEW_JWT_VERIFICATION_SECRET_KEY
ENCRYPT_KEY=TODO_GENERATE_NEW_ENCRYPT_KEY

# JWT Token Configuration
ALGORITHM=HS256
TOKEN_ISSUER=fastapi-rbac
TOKEN_AUDIENCE=your-production-domain.com
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_MINUTES=144000
REFRESH_TOKEN_EXPIRE_DAYS=100

#############################################
# Database Configuration - PostgreSQL
#############################################
DATABASE_TYPE=postgresql
DATABASE_HOST=fastapi_rbac_db_prod
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=TODO_CHANGE_THIS_PASSWORD
DATABASE_NAME=fastapi_db
DATABASE_CELERY_NAME=celery_schedule_jobs

# Connection Pool Settings
DB_POOL_SIZE=83
WEB_CONCURRENCY=9
POOL_SIZE=10

#############################################
# Redis Configuration - SSL/TLS Enabled
# 
# IMPORTANT: Redis uses SSL/TLS in production for secure connections.
# Certificates must be generated before deployment.
# See: backend/docs/REDIS_SSL_SETUP.md
#############################################
REDIS_HOST=fastapi_rbac_redis_prod
REDIS_PORT=6379
REDIS_PASSWORD=TODO_CHANGE_THIS_PASSWORD
REDIS_SSL=true

# Redis SSL Certificate Configuration
# Path to SSL certificates (defaults to /app/certs in container)
REDIS_CERT_PATH=/app/certs

# SSL Hostname Verification (recommended: true)
REDIS_SSL_CHECK_HOSTNAME=true

# Redis URL (automatically constructed, no need to set manually)
# Format: rediss://default:PASSWORD@HOST:PORT/DB
# Example: rediss://default:password123@fastapi_rbac_redis_prod:6379/0

#############################################
# Celery Configuration - SSL/TLS Enabled
# 
# Celery uses Redis as broker and backend with SSL/TLS
#############################################
# Note: CELERY_BROKER_URL and CELERY_RESULT_BACKEND are automatically
# constructed from REDIS_* settings. The SSL configuration is handled
# in app/core/celery_config.py based on the MODE setting.

CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=["json"]
CELERY_TIMEZONE=UTC
CELERY_BEAT_SCHEDULER=celery.beat:PersistentScheduler

#############################################
# Email Configuration (SMTP)
# TODO: Configure your production email service
#############################################
EMAILS_ENABLED=true
SMTP_TLS=true
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
EMAILS_FROM_EMAIL=noreply@your-production-domain.com
EMAILS_FROM_NAME=FastAPI RBAC

#############################################
# Admin User Configuration
# TODO: Set secure admin credentials
#############################################
FIRST_SUPERUSER_EMAIL=admin@your-production-domain.com
FIRST_SUPERUSER_PASSWORD=TODO_CHANGE_THIS_PASSWORD
USER_CHANGED_PASSWORD_DATE=2025-01-01

# Admin-created user settings
ADMIN_CREATED_USERS_AUTO_VERIFIED=true
ADMIN_CREATED_USERS_SEND_EMAIL=false

#############################################
# Security Settings - Password Policy
#############################################
PASSWORD_MIN_LENGTH=12
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGITS=true
PASSWORD_REQUIRE_SPECIAL=true
PASSWORD_SPECIAL_CHARS=!@#$%^&*()_+-=[]{}|;:,.<>?
PASSWORD_HASHING_ITERATIONS=12
PASSWORD_PREVENT_REUSE=true
PREVENT_COMMON_PASSWORDS=true
PREVENT_SEQUENTIAL_CHARS=true
PREVENT_REPEATED_CHARS=true

# Password history and rotation
PASSWORD_HISTORY_SIZE=5
PREVENT_PASSWORD_REUSE=5
REQUIRE_PASSWORD_CHANGE_DAYS=90
PASSWORD_MIN_AGE_HOURS=24

#############################################
# Security Settings - Account Lockout
#############################################
ENABLE_ACCOUNT_LOCKOUT=true
ACCOUNT_LOCKOUT_MINUTES=1440
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15
MAX_PASSWORD_CHANGE_ATTEMPTS=3
ACCOUNT_LOCKOUT_DURATION=1800

#############################################
# Security Settings - Session Management
#############################################
SESSION_MAX_AGE=3600
SESSION_EXTEND_ON_ACTIVITY=true
REQUIRE_MFA_AFTER_INACTIVITY=true
INACTIVITY_TIMEOUT=1800
CONCURRENT_SESSION_LIMIT=5

#############################################
# Security Settings - Token Management
#############################################
ACCESS_TOKEN_ENTROPY_BITS=256
VERIFY_TOKEN_ON_EVERY_REQUEST=true
TOKEN_VERSION_ON_PASSWORD_CHANGE=true
VALIDATE_TOKEN_IP=true
TOKEN_BLACKLIST_ON_LOGOUT=true
TOKEN_BLACKLIST_EXPIRY=86400

#############################################
# Security Settings - Email Verification
#############################################
EMAIL_VERIFICATION_TOKEN_EXPIRE_MINUTES=1440
EMAIL_VERIFICATION_URL=https://your-production-domain.com/verify-email
MAX_VERIFICATION_ATTEMPTS_PER_HOUR=5
VERIFICATION_COOLDOWN_SECONDS=300
UNVERIFIED_ACCOUNT_CLEANUP_HOURS=72

#############################################
# Security Settings - Registration
#############################################
MAX_REGISTRATION_ATTEMPTS_PER_HOUR=5
MAX_REGISTRATION_ATTEMPTS_PER_EMAIL=3
UNVERIFIED_ACCOUNT_CLEANUP_DELAY_HOURS=24
EMAIL_DOMAIN_BLACKLIST=[]
EMAIL_DOMAIN_ALLOWLIST=[]

#############################################
# Security Settings - Rate Limiting
#############################################
RATE_LIMIT_PERIOD_SECONDS=3600
MAX_RESEND_VERIFICATION_ATTEMPTS_PER_HOUR=3
RATE_LIMIT_PERIOD_RESEND_VERIFICATION_SECONDS=3600
ENABLE_BRUTE_FORCE_PROTECTION=true
BRUTE_FORCE_TIME_WINDOW=3600

#############################################
# PgAdmin Configuration (Optional)
# For database administration interface
#############################################
PGADMIN_DEFAULT_EMAIL=admin@example.com
PGADMIN_DEFAULT_PASSWORD=TODO_CHANGE_THIS_PASSWORD
PGADMIN_PORT=5050

#############################################
# Production Deployment Notes
#############################################
# 
# Before deploying to production:
# 
# 1. Generate SSL Certificates for Redis:
#    cd backend/certs && ./generate-certs.sh
# 
# 2. Generate all security keys:
#    python -c "import secrets; print(secrets.token_urlsafe(32))"
# 
# 3. Update all TODO fields in this file
# 
# 4. Set strong passwords (32+ characters recommended)
# 
# 5. Configure your production domain in:
#    - FRONTEND_URL
#    - TOKEN_AUDIENCE
#    - BACKEND_CORS_ORIGINS
#    - EMAIL_VERIFICATION_URL
# 
# 6. Configure SMTP settings for email delivery
# 
# 7. Review security settings and adjust as needed
# 
# 8. Never commit this file with real credentials to version control
# 
# For detailed setup instructions, see:
# - backend/docs/REDIS_SSL_SETUP.md
# - backend/docs/REDIS_SSL_IMPLEMENTATION_SUMMARY.md
#############################################
